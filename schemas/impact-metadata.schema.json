{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://apex-humanity.protocol/schemas/impact-metadata/v1.0.json",
  "title": "APEX HUMANITY — Impact Metadata Schema",
  "description": "Canonical schema for a Proof of Beneficial Action (PoBA) event submission. This document travels from dApp → SATIN Oracle → IPFS → Blockchain.",
  "type": "object",
  "required": [
    "event_id",
    "volunteer_address",
    "beneficiary_zkp_hash",
    "action_type",
    "urgency_level",
    "description",
    "effort_hours",
    "gps_coordinates",
    "poverty_index",
    "ipfs_media_cid",
    "zkp_bundle",
    "action_timestamp_utc",
    "submission_timestamp_utc"
  ],
  "properties": {
    "schema_version": {
      "type": "string",
      "const": "1.0.0",
      "description": "Version of this schema for forward compatibility"
    },
    "event_id": {
      "type": "string",
      "format": "uuid",
      "description": "Globally unique event identifier (UUID v4)"
    },
    "volunteer_address": {
      "type": "string",
      "pattern": "^0x[a-fA-F0-9]{40}$",
      "description": "EVM-compatible wallet address of the volunteer (checksummed preferred)"
    },
    "beneficiary_zkp_hash": {
      "type": "string",
      "pattern": "^[a-f0-9]{64}$",
      "description": "SHA-256 hash derived from the beneficiary's ZK circuit witness. NEVER contains real identity data."
    },
    "action_type": {
      "type": "string",
      "enum": [
        "FOOD_DISTRIBUTION",
        "MEDICAL_AID",
        "SHELTER_CONSTRUCTION",
        "EDUCATION_SESSION",
        "DISASTER_RELIEF",
        "CLEAN_WATER_PROJECT",
        "MENTAL_HEALTH_SUPPORT",
        "ENVIRONMENTAL_ACTION"
      ],
      "description": "Category of the beneficial action performed"
    },
    "urgency_level": {
      "type": "string",
      "enum": ["CRITICAL", "HIGH", "MEDIUM", "LOW"],
      "description": "Severity/urgency of the situation addressed"
    },
    "description": {
      "type": "string",
      "minLength": 20,
      "maxLength": 2000,
      "description": "Human-readable narrative of the action performed (analyzed by NLP)"
    },
    "effort_hours": {
      "type": "number",
      "minimum": 0.1,
      "maximum": 720,
      "description": "Approximate hours of effort invested by the volunteer"
    },
    "beneficiary_count": {
      "type": "integer",
      "minimum": 1,
      "description": "Estimated number of people directly helped"
    },
    "gps_coordinates": {
      "type": "object",
      "required": ["latitude", "longitude", "timestamp_utc"],
      "properties": {
        "latitude": {
          "type": "number",
          "minimum": -90,
          "maximum": 90,
          "description": "WGS84 latitude"
        },
        "longitude": {
          "type": "number",
          "minimum": -180,
          "maximum": 180,
          "description": "WGS84 longitude"
        },
        "altitude": {
          "type": "number",
          "description": "Altitude in meters above sea level"
        },
        "accuracy_meters": {
          "type": "number",
          "minimum": 0,
          "description": "GPS accuracy radius in meters"
        },
        "timestamp_utc": {
          "type": "string",
          "format": "date-time",
          "description": "ISO 8601 timestamp of GPS capture"
        },
        "w3w_address": {
          "type": "string",
          "description": "Optional What3Words address for offline zones (e.g. 'filled.count.soap')"
        }
      }
    },
    "poverty_index": {
      "type": "number",
      "minimum": 0.0,
      "maximum": 1.0,
      "description": "UN Human Development Index poverty score for the location (0=wealthy, 1=extreme poverty)"
    },
    "ipfs_media_cid": {
      "type": "string",
      "pattern": "^(Qm[1-9A-HJ-NP-Za-km-z]{44}|bafy[a-z2-7]{55})$",
      "description": "IPFS Content Identifier (CIDv0 or CIDv1) of encrypted photo/video proof"
    },
    "ipfs_metadata_cid": {
      "type": "string",
      "description": "IPFS CID of this metadata document itself (set after upload, creates self-referential immutable record)"
    },
    "media_encryption": {
      "type": "object",
      "description": "Encryption metadata for the IPFS media content",
      "properties": {
        "algorithm": {
          "type": "string",
          "enum": ["AES-256-GCM", "ChaCha20-Poly1305"],
          "default": "AES-256-GCM"
        },
        "key_derivation": {
          "type": "string",
          "description": "How the decryption key is derived (e.g. 'lit-protocol' for decentralized access control)"
        },
        "access_condition": {
          "type": "string",
          "description": "Who can decrypt: 'oracle-only' | 'volunteer' | 'dao-vote'"
        }
      }
    },
    "zkp_bundle": {
      "type": "object",
      "description": "Zero-Knowledge Proof bundle protecting beneficiary identity",
      "required": ["proof_hash", "public_signals", "verification_key_hash", "protocol"],
      "properties": {
        "proof_hash": {
          "type": "string",
          "pattern": "^[a-f0-9]{64}$",
          "description": "Poseidon hash of the Groth16 proof (not the proof itself, for privacy)"
        },
        "public_signals": {
          "type": "array",
          "description": "Public inputs to the ZK circuit (non-sensitive)",
          "items": {"type": "string"}
        },
        "verification_key_hash": {
          "type": "string",
          "description": "Hash of the Groth16 verification key used to validate the proof"
        },
        "protocol": {
          "type": "string",
          "enum": ["groth16", "plonk", "stark"],
          "default": "groth16"
        },
        "curve": {
          "type": "string",
          "enum": ["bn128", "bls12_381"],
          "default": "bn128"
        },
        "circuit_id": {
          "type": "string",
          "description": "Identifier of the ZK circuit used (links to on-chain verifier)"
        }
      }
    },
    "action_timestamp_utc": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 timestamp of when the action was performed"
    },
    "submission_timestamp_utc": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 timestamp of when the proof was submitted to the oracle"
    },
    "oracle_output": {
      "type": "object",
      "description": "Fields populated by the SATIN Oracle after verification (READ-ONLY after oracle processing)",
      "properties": {
        "satin_version": {
          "type": "string",
          "description": "Version of the SATIN engine that processed this event"
        },
        "impact_score": {
          "type": "number",
          "minimum": 0,
          "maximum": 100,
          "description": "Final normalized impact score (0–100)"
        },
        "ai_confidence": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "description": "AI model confidence in the evidence (0.0–1.0)"
        },
        "verification_status": {
          "type": "string",
          "enum": ["VERIFIED", "REJECTED", "PENDING_REVIEW", "INSUFFICIENT_PROOF"]
        },
        "rejection_reason": {
          "type": "string",
          "description": "Human-readable reason if rejected"
        },
        "event_hash": {
          "type": "string",
          "pattern": "^[a-f0-9]{64}$",
          "description": "SHA-256 canonical hash of the event (signed by oracle)"
        },
        "oracle_signature": {
          "type": "string",
          "pattern": "^[a-f0-9]+$",
          "description": "ECDSA signature of event_hash by oracle's secp256k1 key"
        },
        "oracle_address": {
          "type": "string",
          "pattern": "^0x[a-fA-F0-9]{40}$",
          "description": "Ethereum address corresponding to oracle signing key"
        },
        "processing_timestamp_utc": {
          "type": "string",
          "format": "date-time"
        },
        "cv_analysis": {
          "type": "object",
          "description": "Computer vision analysis results",
          "properties": {
            "detected_objects": {
              "type": "array",
              "items": {"type": "string"}
            },
            "is_sharp": {"type": "boolean"},
            "image_dimensions": {
              "type": "object",
              "properties": {
                "width": {"type": "integer"},
                "height": {"type": "integer"}
              }
            }
          }
        }
      }
    },
    "on_chain_tx": {
      "type": "object",
      "description": "Blockchain transaction data after on-chain submission",
      "properties": {
        "network": {
          "type": "string",
          "description": "Chain name (e.g. 'polygon', 'ethereum', 'arbitrum')"
        },
        "chain_id": {
          "type": "integer",
          "description": "EVM chain ID"
        },
        "tx_hash": {
          "type": "string",
          "pattern": "^0x[a-fA-F0-9]{64}$",
          "description": "Transaction hash of the submitVerifiedImpact() call"
        },
        "block_number": {
          "type": "integer"
        },
        "good_tokens_minted": {
          "type": "string",
          "description": "Amount of GOOD tokens minted (wei string)"
        },
        "usdc_released": {
          "type": "string",
          "description": "Amount of USDC released (smallest unit string)"
        }
      }
    }
  },
  "additionalProperties": false,

  "examples": [
    {
      "schema_version": "1.0.0",
      "event_id": "f47ac10b-58cc-4372-a567-0e02b2c3d479",
      "volunteer_address": "0xAbCdEf1234567890AbCdEf1234567890AbCdEf12",
      "beneficiary_zkp_hash": "a3f2b1c4d5e6f7a8b9c0d1e2f3a4b5c6d7e8f9a0b1c2d3e4f5a6b7c8d9e0f1a2",
      "action_type": "FOOD_DISTRIBUTION",
      "urgency_level": "HIGH",
      "description": "Distributed 200 emergency food packages to 200 displaced families in the Al-Hudaydah province. Coordinated with local NGO Al-Salam. Packages included rice, lentils, and cooking oil.",
      "effort_hours": 8,
      "beneficiary_count": 200,
      "gps_coordinates": {
        "latitude": 14.7981,
        "longitude": 42.9516,
        "altitude": 15.0,
        "accuracy_meters": 5.2,
        "timestamp_utc": "2025-02-14T08:30:00Z",
        "w3w_address": "rapid.bond.gains"
      },
      "poverty_index": 0.95,
      "ipfs_media_cid": "bafybeigdyrzt5sfp7udm7hu76uh7y26nf3efuylqabf3oclgtqy55fbzdi",
      "zkp_bundle": {
        "proof_hash": "deadbeefcafe1234deadbeefcafe1234deadbeefcafe1234deadbeefcafe1234",
        "public_signals": ["1", "0xAbCdEf1234567890AbCdEf1234567890AbCdEf12"],
        "verification_key_hash": "9f8e7d6c5b4a3928172615243342516070819293",
        "protocol": "groth16",
        "curve": "bn128",
        "circuit_id": "beneficiary-identity-v1"
      },
      "action_timestamp_utc": "2025-02-14T08:00:00Z",
      "submission_timestamp_utc": "2025-02-14T10:15:33Z",
      "oracle_output": {
        "satin_version": "1.0.0",
        "impact_score": 87.5,
        "ai_confidence": 0.91,
        "verification_status": "VERIFIED",
        "event_hash": "3a4b5c6d7e8f9a0b1c2d3e4f5a6b7c8d9e0f1a2b3c4d5e6f7a8b9c0d1e2f3a4b",
        "oracle_signature": "3045022100abc...def",
        "oracle_address": "0xOracleAddress1234567890AbCdEf1234567890",
        "processing_timestamp_utc": "2025-02-14T10:16:02Z"
      }
    }
  ]
}
